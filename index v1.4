var gb ={ "results":
            [
                {
                    "imc": -1
                },
                {
                    "alimentos":[
                
                    ]
                }
            ]
        };
var db = JSON.parse(localStorage.getItem('db_results_real1'));
if (!db) {
    db = gb;
};
//constantes que estavam no outro doc imcfy

const esconder = 'esconder';
const mostrar = 'mostrar';

function funcaoClassificar(){
    const res = document.getElementsByClassName('resultado')[0];
    var peso = document.getElementById('peso');
    var altura = document.getElementById('altura');
    var pesoDaPessoa = Number(peso.value);
    var alturaDaPessoa = Number(altura.value)/100;
    var imc = pesoDaPessoa / (alturaDaPessoa * alturaDaPessoa);
    var imcArredondado = parseFloat(imc.toFixed(0));
    db.results[0].imc = imcArredondado;
    //atualiza o db
    localStorage.setItem('db_results_real1', JSON.stringify(db));

    if(imc < 0){
        res.innerHTML = "Erro Não existe imc negativo !!! seu imc é de " + imc;
    }
    else{
        if(imc < 17){
            var conteudo = `<span class="imc-resultado">${imcArredondado}</span> <img src="${"./images/IMC/sprite1.png"}"/>`;  //peso extremamente baixo coma mais !!!
            var alerta = `<div class="alerta" style="background: #dc301b"><i class="fas fa-lightbulb"> </i><p>Hey, parece que seu peso está muito abaixo do ideal! Que tal verificar uma <a href="">dieta balanceada</a> para ganhar massa corporal?</p></div>`
        }
        else{
            if(imc <= 18.49){
                var conteudo = `<span class="imc-resultado">${imcArredondado}</span> <img src="${"./images/IMC/sprite2.png"}"/>`; // peso abaixo da media coma um pouco mais !!!
                var alerta = `<div class="alerta" style="background: #dc6c1b"><i class="fas fa-lightbulb"> </i><p>Hey, parece que seu peso está abaixo do ideal! Que tal verificar uma <a href="">dieta balanceada</a> para ganhar massa corporal?</p></div>`
            }
            else{
                if(imc <= 24.99){
                    var conteudo = `<span class="imc-resultado">${imcArredondado}</span> <img src="${"./images/IMC/sprite3.png"}"/>`; // peso normal mantenha !!! a saúde
                    var alerta = `<div class="alerta" style="background: #8adc1b"><i class="fas fa-lightbulb"></i><p>Hey, parece que seu peso está dentro do ideal! Que tal verificar uma <a href="">dieta balanceada</a> para mantê-lo?</p></div>`
                }
                else{
                    if(imc <= 29.99){
                        var conteudo = `<span class="imc-resultado">${imcArredondado}</span> <img src="${"./images/IMC/sprite4.png"}"/>`; // peso ligeiramente acima da média!!!
                        var alerta = `<div class="alerta" style="background: #cadc1b"><i class="fas fa-lightbulb"> </i><p>Hey, parece que seu peso ligeiramente acima do ideal! Que tal verificar uma <a href="">dieta balanceada</a> para perder massa corporal?</p></div>`
                    }
                    else{
                        if(imc <= 34.99){
                            var conteudo = `<span class="imc-resultado">${imcArredondado}</span> <img src="${"./images/IMC/sprite5.png"}"/>`; //Pessoa com nível de obesidade 1
                            var alerta = `<div class="alerta" style="background: #dc981b"><i class="fas fa-lightbulb"> </i><p>Hey, parece que seu peso está acima do ideal! Que tal verificar uma <a href="">dieta balanceada</a> para perder massa corporal?</p></div>`
                        }
                        else{
                            if(imc <= 39.99){
                                var conteudo = `<span class="imc-resultado">${imcArredondado}</span> <img src="${"./images/IMC/sprite6.png"}"/>`; //Pessoa com nível de obesidade 2
                                var alerta = `<div class="alerta" style="background: #dc6c1b"><i class="fas fa-lightbulb"> </i><p>Hey, parece que seu peso está bem acima do ideal! Que tal verificar uma <a href="">dieta balanceada</a> para perder massa corporal?</p></div>`
                            }
                            else{
                                var conteudo = `<span class="imc-resultado">${imcArredondado}</span> <img src="${"./images/IMC/sprite7.png"}"/>`; //Pessoa com nível de obesidade 3
                                var alerta = `<div class="alerta" style="background: #dc301b"><i class="fas fa-lightbulb"> </i><p>Hey, parece que seu peso está muito acima do ideal! Que tal verificar uma <a href="">dieta balanceada</a> para perder massa corporal?</p></div>`
                            }
                        }
                    }
                }
            }
        }
    }
    document.getElementById('resultado').innerHTML = conteudo;
    document.getElementById('spamdealerta').innerHTML = alerta;
}

//função passagem imc

function imcGlobal(){
    if(db.results[0].imc === -1){
        var alerta =`  <a href=${"./IMC.fy.html"}><div class=${"alerta"}>
                            <p>Peehhhhhhh tem que calcular seu Imc primeiro para ter acesso à uma dieta!!!</p>
                            <span>Clique nesta box para ir para Calcular seu IMC!!!</span>
                        </div>
                    `;
        $('#res').html(alerta);
    }
    else{
        $('#res').html("");
        console.log(db.results[0].imc);
    }
}

//mostrar array de alimentos selecionados
function mostrarArranjo(){
    for(var i = 0; i < db.results[1].alimentos.length; i++){
        var item = db.results[1].alimentos[i];
        $('#resposta').append(item);
    }
}

//Colocar alimento separado por arranjos
function funcaoSelecionarAlimento(nome){
    let novoAlimento = nome;
    db.results[1].alimentos.push(novoAlimento);
    localStorage.setItem('db_results_real1', JSON.stringify(db));
}

let iplus;
//Colocar opções de alimentos pertencentes as categorias pelos indices
function funcaoBuscarAlimentos(indice){
    $.ajax({
        url: `https://taco-food-api.herokuapp.com/api/v1/category/${indice}/food`,
        success: function(dados){
            let opcoes = "";
            for(var i = 0; i < dados.length; i++){
                opcoes += ` <div onclick=funcaoSelecionarAlimento(${dados[i].description})>
                                <p>Nome ${dados[i].description} </p></br> </br>
                                <p>kcal : ${dados[i].attributes.energy.kcal}
                            </div>`;
            }
            $('.botoes').html(opcoes);
        }
    });
}

//Criar botões categorizados 
function criarBotoes(){
    $.ajax({
    
        url: `https://taco-food-api.herokuapp.com/api/v1/category`,
        success: function (dados, status, req) {
            let texto = "";
            for(let i = 0; i < dados.length; i++){
                iplus = i + 1;
                texto += `  <button onclick=funcaoBuscarAlimentos(${iplus})> botão ${iplus} </button>`;
            }
            console.log(texto);
            $('.categorias-alimentos').html(texto);
        }
    });
}
    



